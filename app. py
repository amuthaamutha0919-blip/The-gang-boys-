import 'package:flutter/material.dart';
import 'package:flutter_tts/flutter_tts.dart';
import 'dart:async';
import 'dart:math';
import 'package:intl/intl.dart';

void main() => runApp(GangBoysApp());

class GangBoysApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      debugShowCheckedModeBanner: false,
      title: 'GANG BOYS ЁЯе╖',
      theme: ThemeData(
        brightness: Brightness.dark,
        primaryColor: Colors.black,
        scaffoldBackgroundColor: const Color(0xFF121212),
      ),
      home: LoginPage(),
    );
  }
}

// --- ро▓ро╛роХро┐ройрпН рокроХрпНроХроорпН ---
class LoginPage extends StatefulWidget {
  @override
  _LoginPageState createState() => _LoginPageState();
}

class _LoginPageState extends State<LoginPage> {
  final TextEditingController _name = TextEditingController();
  final TextEditingController _phone = TextEditingController();
  final TextEditingController _dob = TextEditingController(); // Format: DD-MM
  final TextEditingController _pass = TextEditingController();

  void checkLogin() {
    bool isAdmin = (_pass.text == "admintest@123");
    bool isMember = (_pass.text == "membertest@123");

    if (isAdmin || isMember) {
      String today = DateFormat('dd-MM').format(DateTime.now());
      
      if (_dob.text == today) {
        Navigator.pushReplacement(context, MaterialPageRoute(
          builder: (context) => BirthdayWishPage(userName: _name.text, isAdmin: isAdmin)
        ));
      } else {
        Navigator.pushReplacement(context, MaterialPageRoute(
          builder: (context) => HomePage(isAdmin: isAdmin, userName: _name.text)
        ));
      }
    } else {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text("родро╡ро▒ро╛рой рокро╛ро╕рпНро╡рпЗро░рпНроЯрпБ!"))
      );
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Center(
        child: SingleChildScrollView(
          padding: const EdgeInsets.all(30),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              Image.network('https://i.ibb.co/CpjYwp5r/logo.png', height: 120),
              const SizedBox(height: 20),
              const Text("GANG BOYS ЁЯе╖", 
                style: TextStyle(fontSize: 30, color: Colors.amber, fontWeight: FontWeight.bold)),
              const SizedBox(height: 40),
              _buildInput(_name, "рокрпЖропро░рпН", Icons.person),
              _buildInput(_phone, "родрпКро▓рпИрокрпЗроЪро┐ роОрогрпН", Icons.phone),
              _buildInput(_dob, "рокро┐ро▒роирпНрод родрпЗродро┐ (DD-MM)", Icons.cake),
              _buildInput(_pass, "рокро╛ро╕рпНро╡рпЗро░рпНроЯрпБ", Icons.lock, obscure: true),
              const SizedBox(height: 30),
              ElevatedButton(
                style: ElevatedButton.styleFrom(
                  backgroundColor: Colors.amber, 
                  minimumSize: const Size(double.infinity, 50),
                  shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(10))
                ),
                onPressed: checkLogin,
                child: const Text("роирпБро┤рпИро╡рпБ", 
                  style: TextStyle(color: Colors.black, fontWeight: FontWeight.bold, fontSize: 18)),
              ),
            ],
          ),
        ),
      ),
    );
  }

  Widget _buildInput(TextEditingController ctrl, String hint, IconData icon, {bool obscure = false}) {
    return Padding(
      padding: const EdgeInsets.symmetric(vertical: 8.0),
      child: TextField(
        controller: ctrl,
        obscureText: obscure,
        decoration: InputDecoration(
          prefixIcon: Icon(icon, color: Colors.amber),
          hintText: hint,
          filled: true,
          fillColor: Colors.white10,
          border: OutlineInputBorder(borderRadius: BorderRadius.circular(10)),
        ),
      ),
    );
  }
}

// --- рокро┐ро▒роирпНродроиро╛ро│рпН ро╡ро╛ро┤рпНродрпНродрпБ рокроХрпНроХроорпН ---
class BirthdayWishPage extends StatefulWidget {
  final String userName;
  final bool isAdmin;
  BirthdayWishPage({required this.userName, required this.isAdmin});

  @override
  _BirthdayWishPageState createState() => _BirthdayWishPageState();
}

class _BirthdayWishPageState extends State<BirthdayWishPage> with TickerProviderStateMixin {
  final FlutterTts flutterTts = FlutterTts();
  late AnimationController _controller;

  @override
  void initState() {
    super.initState();
    _playVoice();
    _controller = AnimationController(vsync: this, duration: const Duration(seconds: 5))..repeat();
    
    Timer(const Duration(seconds: 8), () {
      if (mounted) {
        Navigator.pushReplacement(context, MaterialPageRoute(
          builder: (context) => HomePage(isAdmin: widget.isAdmin, userName: widget.userName)
        ));
      }
    });
  }

  void _playVoice() async {
    await flutterTts.setLanguage("ta-IN");
    await flutterTts.speak("роЗройро┐роп рокро┐ро▒роирпНродроиро╛ро│рпН ро╡ро╛ро┤рпНродрпНродрпБроХрпНроХро│рпН ${widget.userName}");
  }

  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.black,
      body: Stack(
        children: [
          ...List.generate(15, (i) => _buildBalloon()),
          Center(
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                Image.network('https://i.ibb.co/CpjYwp5r/logo.png', width: 150),
                const SizedBox(height: 30),
                const Text("роЗройро┐роп рокро┐ро▒роирпНродроиро╛ро│рпН ро╡ро╛ро┤рпНродрпНродрпБроХрпНроХро│рпН!", 
                  style: TextStyle(fontSize: 24, color: Colors.amber, fontWeight: FontWeight.bold)),
                Text(widget.userName, 
                  style: const TextStyle(fontSize: 45, fontWeight: FontWeight.bold, color: Colors.white)),
                const SizedBox(height: 10),
                const Text("GANG BOYS ЁЯе╖", style: TextStyle(color: Colors.white54, fontSize: 18)),
              ],
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildBalloon() {
    double leftPosition = Random().nextDouble() * MediaQuery.of(context).size.width;
    return AnimatedBuilder(
      animation: _controller,
      builder: (context, child) {
        return Positioned(
          bottom: (_controller.value * 1.2) * MediaQuery.of(context).size.height,
          left: leftPosition,
          child: Icon(Icons.circle, 
            color: Colors.primaries[Random().nextInt(Colors.primaries.length)].withOpacity(0.7), 
            size: 50),
        );
      },
    );
  }
}

// --- роорпБроХрокрпНрокрпБрокрпН рокроХрпНроХроорпН ---
class HomePage extends StatelessWidget {
  final bool isAdmin;
  final String userName;
  HomePage({required this.isAdmin, required this.userName});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text("GANG BOYS ЁЯе╖"),
        backgroundColor: Colors.black,
        actions: [
          Padding(
            padding: const EdgeInsets.all(8.0),
            child: Image.network('https://i.ibb.co/CpjYwp5r/logo.png'),
          )
        ],
      ),
      body: Column(
        children: [
          Container(
            padding: const EdgeInsets.all(20),
            width: double.infinity,
            color: Colors.amber,
            child: Text("роЕройрпНрокрпБроЯройрпН GANG BOYS роХрпБро┤рпБро╡ро┐ро▒рпНроХрпБ ро╡ро░ро╡рпЗро▒рпНроХро┐ро▒рпЛроорпН, $userName! ЁЯЩП",
                textAlign: TextAlign.center, 
                style: const TextStyle(color: Colors.black, fontWeight: FontWeight.bold, fontSize: 16)),
          ),
          const Expanded(
            child: Center(
              child: Text("Dashboard ро╡роЪродро┐роХро│рпН роЗроЩрпНроХрпЗ родрпКроЯроЩрпНроХрпБроорпН..."),
            ),
          ),
        ],
      ),
    );
  }
}
